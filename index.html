<!DOCTYPE html>
<html>

<head>
    <title>èŠ‚ç‚¹è¿çº¿æ¼”ç¤º</title>
    <link rel="stylesheet" href="main.css">
</head>

<body>
    <div id="nav-bar">
        <button id="node-list-button">ğŸ“‹ èŠ‚ç‚¹åˆ—è¡¨</button>
        <button id="settings-button">âš™ï¸ è®¾ç½®</button>
        <button id="proposal-button">ğŸ“„ ç­–åˆ’æ¡ˆ</button>
    </div>
    <div id="node-list-menu" class="menu">
        <h3>èŠ‚ç‚¹åˆ—è¡¨</h3>
        <div id="node-list-container">
            <!-- èŠ‚ç‚¹åˆ—è¡¨é¡¹ä¼šåŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->
        </div>
    </div>
    <div id="settings-menu" class="menu">
        <h3>èŠ‚ç‚¹å›¾è®¾ç½®</h3>
        <button class="reset-button" onclick="GraphManager.resetView()">é‡ç½®è§†å›¾</button>
        <button class="save-button" onclick="GraphManager.saveNodes()">ä¿å­˜</button>
        <button class="load-button" onclick="document.getElementById('fileInput').click()">è¯»å–</button>
        <input type="file" id="fileInput" style="display: none" accept=".json"
            onchange="GraphManager.loadNodes(this.files[0])">
    </div>
    
    <div id="proposal">
        <button id="closeProposal">å…³é—­</button>
        <div id="proposalContent"></div>
    </div>
    <script src="./js/node.js"></script>

    <script src="./js/graph.js"></script>
    <script src="./js/component.js"></script>
    <script src="js/group.js"></script>

    <script>
        GraphManager.init();
        var node1 = new Node(100, 100, new NodeType(
            'åŸºç¡€èŠ‚ç‚¹', 
            'æ¸¸æˆè®¾è®¡åŠ¨æœº', 
            2, 
            3, 
            (data) => {
                if(data!=null){
                    // è¾“å…¥èŠ‚ç‚¹çš„å¤„ç†é€»è¾‘
                    return `${data}->æˆ‘çš„èŠ‚ç‚¹1`;
                }
                return `æˆ‘çš„èŠ‚ç‚¹1`;
            }
        ));
        var node2 = new Node(500, 200, new NodeType(
            'åŸºç¡€èŠ‚ç‚¹', 
            'æ¸¸æˆè®¾è®¡ä½“éªŒ', 
            3, 
            3, 
            (data) => {
                if(data!=null){
                    let result = `${data}->æˆ‘çš„èŠ‚ç‚¹2`;
                    document.getElementById("proposalContent").innerHTML = result; // ä½¿ç”¨ innerHTML ä»¥æ”¯æŒ HTML
                    document.getElementById("proposal").style.display = "block";
                    return result;
                }
                return `æˆ‘çš„èŠ‚ç‚¹2`;
            }
        ));
        NodeManager.registerNode(node1);
        // NodeManager.registerNode(node2);
        node1.addInput();
        node1.addInput();
        node1.addOutput();
        node1.addOutput();
        node1.addOutput();
        node2.addInput();

        node1.connectTo(2, node2, 0);
        // ç‚¹å‡»ç©ºç™½å¤„å…³é—­èœå•
        document.addEventListener('click', function (e) {
            const menu = document.querySelector('.context-menu');
            if (menu && !menu.contains(e.target)) {
                menu.remove();
            }
        });
        document.getElementById('closeProposal').addEventListener('click', function() {
            document.getElementById('proposal').style.display = 'none';
        });

        document.getElementById('node-list-button').addEventListener('click', function() {
            toggleMenu('node-list-menu', this);
        });

        document.getElementById('settings-button').addEventListener('click', function() {
            toggleMenu('settings-menu', this);
        });

        document.getElementById('proposal-button').addEventListener('click', function() {
            toggleProposal(this);
        });

        function toggleMenu(menuId, button) {
            const menu = document.getElementById(menuId);
            if (menu.style.display === 'block') {
                menu.style.display = 'none';
                button.classList.remove('active');
            } else {
                menu.style.display = 'block';
                button.classList.add('active');
            }
        }

        function toggleProposal(button) {
            const proposal = document.getElementById('proposal');
            if (proposal.style.display === 'block') {
                proposal.style.display = 'none';
                button.classList.remove('active');
            } else {
                proposal.style.display = 'block';
                button.classList.add('active');
            }
        }

        // ä½¿å¯¼èˆªæ å¯æ‹–åŠ¨
        makeDraggable(document.getElementById('nav-bar'));

        function makeDraggable(element) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            element.onmousedown = dragMouseDown;

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        makeDraggable(document.getElementById('node-list-menu'));
        makeDraggable(document.getElementById('settings-menu'));
    </script>




</body>

</html>